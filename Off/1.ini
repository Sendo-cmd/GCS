1. โครงสร้างหลักของ Auto Play (Core Flow)
1.1 ลำดับการทำงานหลัก (Main Loop)
ทุก ๆ Tick / Interval:
1. ตรวจสอบ Yen (เงิน) ก่อนทุกการกระทำ
2. ประเมินสถานการณ์จาก:
   - Wave ปัจจุบัน
   - Enemy Progress (% path ที่ enemy เดินไปแล้ว)
3. ตัดสินใจ Action:
   - วาง (Place)
   - อัพเกรด (Upgrade)
   - ขาย (Sell)
4. แยก Logic ตามประเภท Unit
5. หลังทำ Action 1 อย่าง → Wait → Recheck
Hard Rule
ทำได้แค่ 1 action ต่อรอบ
ห้าม spam วาง / spam อัพเกรด
2. ประเภท Unit (Unit Classification)
2.1 Economy Unit (ตัวเงิน)
หน้าที่
เพิ่ม Yen ให้ระบบ
Priority
สูงสุด (อันดับ 1)
การวาง Economy Unit
- ต้องวางก่อน Unit ทุกประเภท
- วาง "นอก path" เท่านั้น
- เลือกตำแหน่งที่:
    - ไม่อยู่บน path
    - ระยะห่างจาก path มากที่สุด
ตัวเงินไม่ต้องยิง → ไม่จำเป็นต้องใกล้ path
การอัพเกรด Economy Unit
- เป็นเป้าหมายอัพเกรดหลัก
- อัพทีละ 1 ขั้น
- อัพจนกว่าจะถึงระดับที่กำหนด หรือเงินไม่พอ
การขาย Economy Unit
- ขายเฉพาะ Economy Unit เท่านั้น
- ขายเมื่อถึง Max Wave ของด่าน
- ถ้าบางตัวขายไม่ได้ → ข้าม
Logic
if currentWave == maxWave:
    sell all sellable Economy Units
2.2 Damage Unit (ตัวดาเมจ)
หน้าที่
โจมตี Enemy
Priority
รองจาก Economy Unit (อันดับ 2)
การวาง Damage Unit
- วางหลัง Economy Unit เสมอ
- วางใกล้ path
- ห้ามวาง outside corner (มุมแหลมด้านนอก)
ตำแหน่งที่เหมาะสมต้อง:
ยิงโดน path มากกว่า 1 เส้น (ถ้ามี)
ครอบคลุม path ได้มากที่สุด
อยู่ในตำแหน่งที่ enemy อยู่ใน range นาน
อยู่ใกล้ Enemy Base ได้ (เพื่อกันบ้านแตก / บอส)
- เลือกอัพ Unit ที่ "แรงที่สุด" เสมอ
- อัพทีละ 1 ขั้น
นิยามคำว่า "แรงที่สุด"
DamageScore = DPS * TimeInRange
เลือก Unit ที่ DamageScore สูงสุด
2.3 Buff Unit (ตัวบัพ)
หน้าที่
บัพ Unit อื่น
Priority
ต่ำสุด (อันดับ 3)
การวาง Buff Unit
- วางหลังสุด
- ต้องอยู่ในระยะบัพที่ครอบคลุม:
    - Economy Unit
    - Damage Unit
    - Unit สำคัญทั้งหมด
Logic
เลือกตำแหน่งที่ Buff Coverage สูงสุด
3. ระบบวาง Unit (Placement Logic)
3.1 Placement — Economy Unit
หา position ที่:
- ไม่อยู่บน path
- ระยะห่างจาก path มากที่สุด
3.2 Placement — Damage Unit
สำหรับทุก Candidate Position ใกล้ path:
    - คำนวณระยะยิงของ unit
    - ตรวจสอบ:
        - ยิงโดน path กี่เส้น
        - ครอบคลุม path นานแค่ไหน (Time In Range)
Score
PlacementScore =
  (NumberOfPathsHit * 200)
+ (TimeInRange * 100)
+ InsideCornerBonus
เลือกตำแหน่งที่ Score สูงสุด
Hard Stop
ถ้า TimeInRange < 1 วินาที → ห้ามวาง
3.3 Placement — Buff Unit
เลือกตำแหน่งที่:
- อยู่ในระยะบัพของ Unit ให้ได้มากที่สุด
4. ระบบอัพเกรด (Upgrade Logic)
4.1 กรณี: มี Economy Unit ในทีม
ลำดับปกติ
1. วาง Economy Unit ให้ครบ
2. อัพเกรด Economy Unit เป็นหลัก
ระบบตรวจสอบฉุกเฉิน (Emergency Check)
คำนวณ Enemy Progress จาก path ทั้งหมด
if enemyProgress >= 60%:
    - หยุดอัพเกรด Economy ชั่วคราว
    - วาง Damage Unit เพิ่ม
    - หรืออัพ Damage Unit 1 ขั้น
หลังจากสถานการณ์ดีขึ้น:
กลับไปอัพ Economy Unit ต่อ
4.2 กรณี: ไม่มี Economy Unit ในทีม
- วาง Damage Unit
- อัพเกรด Damage Unit ที่แรงที่สุดเสมอ
5. ระบบขาย Unit (Sell Logic)
ขายเฉพาะ Economy Unit
ขายเมื่อถึง Max Wave
การหา Max Wave
- อ่านค่า maxWave จากข้อมูล map
- ไม่ hardcode
- รองรับรูปแบบ เช่น:
    15/15
    30/30
6. ระบบเช็คเงิน (Anti-Spam Protection)
ก่อนทุก Action:
if yen < cost:
    - ห้ามวาง
    - ห้ามอัพเกรด
    - wait
    - recheck
Hard Rule
ห้าม spam วาง
ห้าม spam อัพเกรด
7. Enemy Mode (กันบ้านแตก / บอส)
หลักการ
ไม่ใช่โหมดดักไกล
แต่เป็นโหมด “ตีทันที”
Enemy Mode Placement Logic
- ตรวจสอบ Enemy Base (จุดเกิดศัตรู)
- วาง Damage Unit 1–2 ตัว
- วางใกล้ Enemy ที่กำลังจะออก
- ไม่วางไกลเกินไป
เป้าหมาย
ยิงโดนมอน
ยิงบอสทันที
ลดเวลาที่ enemy เดินโดยไม่โดนโจมตี